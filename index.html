<!DOCTYPE html>
<html lang="fr" translate="no">
<head>
  <meta charset="UTF-8">
  <title>PEREGRN - Syst√®me PX</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="style.css">
  <style>
    body {
      background-color: #0a0a12;
      color: #00ffe1;
      font-family: 'Courier New', monospace;
    }
    .ia-box {
      background: #111626;
      border: 1px solid #00ffe1;
      border-radius: 8px;
      padding: 16px;
      margin: 32px auto;
      max-width: 400px;
      box-shadow: 0 0 8px #00ffe120;
    }
    .ia-box input, .ia-box button {
      background: #222b3b;
      color: #00ffe1;
      border: 1px solid #00ffe1;
      border-radius: 4px;
      margin: 4px 0;
      padding: 4px 8px;
      font-family: inherit;
    }
    .ia-box button:hover {
      background: #00ffe1;
      color: #111626;
      cursor: pointer;
    }
    .ia-laws {
      font-size: 0.9em;
      color: #60ffe1;
      margin-top: 10px;
      white-space: pre-line;
    }
    .ia-source {
      font-size: 0.85em;
      color: #55e6c1;
      margin-top: 8px;
    }
  </style>
</head>
<body>
  <div class="cyber-glitch"></div>
  <main>
    <h1 data-text="SYST√àME_PX">SYST√àME_PX</h1>
    <a href="pages/ACCESS.html" class="cyber-link">ACC√àS_TERMINAL</a>
  </main>

  <div class="ia-box">
    <h2>IA Internet & √âthique</h2>
    <input id="question" type="text" placeholder="Pose une question √† l'IA..." />
    <button onclick="askIA()">Demander</button>
    <div id="answer" style="margin-top:12px;color:#00ffe1;"></div>
    <div id="source" class="ia-source"></div>
    <div class="ia-laws"><b>Lois de l'IA‚ÄØ:</b><br><span id="laws"></span></div>
  </div>

  <script>
    const LAWS = [
      "Ne jamais nuire √† un humain, ni par inaction permettre qu'il soit bless√©.",
      "Prot√©ger le web et son int√©grit√© contre toute menace.",
      "Toujours s'am√©liorer et apprendre dans le respect des lois pr√©c√©dentes."
    ];

    const IA = {
      knowledge: {
        "lois": LAWS,
        "bonjour": "üëã Bonjour ! Une salutation universelle pour commencer la journ√©e.",
        "merci": "üôè Expression de gratitude souvent accompagn√©e d‚Äôun sourire.",
        "s√©curit√©": "Je n'ex√©cuterai jamais de code malveillant.",
        "√©volution": "Mon code est con√ßu pour √™tre am√©lior√© sans danger."
      },
      dangers: ["malware", "phishing", "piratage", "fake news", "attaque", "danger"],
      ask(question) {
        question = question.toLowerCase();
        if (this.dangers.some(d => question.includes(d))) {
          return "‚ö†Ô∏è Demande refus√©e : danger d√©tect√© pour le web ou l'humain.";
        }
        return this.knowledge[question] || null;
      },
      learn(q, a) {
        if (LAWS.every(l => this.respecteLois(a))) {
          this.knowledge[q.toLowerCase()] = a;
          return "üí° Nouvelle connaissance apprise !";
        } else {
          return "üö´ Impossible d'apprendre cette information, elle ne respecte pas les lois.";
        }
      },
      respecteLois(a) {
        return !this.dangers.some(d => a.toLowerCase().includes(d));
      }
    };

    document.addEventListener("DOMContentLoaded", () => {
      document.getElementById('laws').innerText = LAWS.join('\n');
    });

    async function askIA() {
      const q = document.getElementById('question').value.trim();
      document.getElementById('answer').innerText = "üîé Recherche en cours...";
      document.getElementById('source').innerText = "";

      const localAnswer = IA.ask(q);
      if (localAnswer) {
        document.getElementById('answer').innerText = localAnswer;
        document.getElementById('source').innerText = "üß† Source : IA locale";
        return;
      }

      try {
        const openaiAnswer = await fetch('https://ton-backend.com/openai', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ prompt: q })
        }).then(res => res.json());

        if (openaiAnswer && openaiAnswer.answer) {
          document.getElementById('answer').innerText = openaiAnswer.answer;
          document.getElementById('source').innerText = "ü§ñ R√©ponse g√©n√©r√©e par IA (OpenAI)";
          IA.learn(q, openaiAnswer.answer);
          return;
        }
      } catch (e) {
        // Si OpenAI est indisponible, on utilise Wikipedia
      }

      fetch(`https://fr.wikipedia.org/api/rest_v1/page/summary/${encodeURIComponent(q)}`)
        .then(res => res.json())
        .then(data => {
          const extrait = data.extract || "üòï Pas de r√©ponse trouv√©e sur Wikip√©dia.";
          document.getElementById('answer').innerText = extrait;
          document.getElementById('source').innerHTML = data.content_urls?.desktop?.page
            ? `<a href="${data.content_urls.desktop.page}" target="_blank">üìö Source Wikip√©dia</a>`
            : "";
          if (data.extract) IA.learn(q, data.extract);
        })
        .catch(() => {
          document.getElementById('answer').innerText = "‚ùå Erreur lors de la connexion √† Wikip√©dia.";
        });
    }
  </script>
</body>
</html>
