<!DOCTYPE html>
<html lang="fr" translate="no">
<head>
  <meta charset="UTF-8">
  <title>PEREGRN - Système PX</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="style.css">
  <style>
    body {
      background-color: #0a0a12;
      color: #00ffe1;
      font-family: 'Courier New', monospace;
    }
    /* Ajout léger pour l’IA */
    .ia-box {
      background: #111626;
      border: 1px solid #00ffe1;
      border-radius: 8px;
      padding: 16px;
      margin: 32px auto 0 auto;
      max-width: 400px;
      color: #00ffe1;
      font-size: 1em;
      box-shadow: 0 0 8px #00ffe120;
    }
    .ia-box input, .ia-box button {
      background: #222b3b;
      color: #00ffe1;
      border: 1px solid #00ffe1;
      border-radius: 4px;
      margin: 4px 0;
      padding: 4px 8px;
      font-family: inherit;
    }
    .ia-box button:hover {
      background: #00ffe1;
      color: #111626;
      cursor: pointer;
    }
    .ia-laws {
      font-size: 0.9em;
      color: #60ffe1;
      margin-top: 10px;
      white-space: pre-line;
    }
    .ia-source {
      font-size: 0.85em;
      color: #55e6c1;
      margin-top: 8px;
    }
  </style>
</head>
<body>
  <div class="cyber-glitch"></div>
  <main>
    <h1 data-text="SYSTÈME_PX">SYSTÈME_PX</h1>
    <a href="pages/ACCESS.html" class="cyber-link">ACCÈS_TERMINAL</a>
  </main>

  <!-- IA Éthique & Autonome + Internet -->
  <div class="ia-box">
    <h2>IA Internet & Éthique</h2>
    <input id="question" type="text" placeholder="Pose une question à l'IA..." />
    <button onclick="askIA()">Demander</button>
    <div id="answer" style="margin-top:12px;color:#00ffe1;"></div>
    <div id="source" class="ia-source"></div>
    <div class="ia-laws"><b>Lois de l'IA :</b><br><span id="laws"></span></div>
  </div>
  <script>
    // 3 Lois informatiques (inspirées d'Asimov)
    const LAWS = [
      "Ne jamais nuire à un humain, ni par inaction permettre qu'il soit blessé.",
      "Protéger le web et son intégrité contre toute menace.",
      "Toujours s'améliorer et apprendre dans le respect des lois précédentes."
    ];

    // Base IA locale
    const IA = {
      knowledge: {
        "lois": LAWS,
        "sécurité": "Je n'exécuterai jamais de code malveillant.",
        "évolution": "Mon code est conçu pour être amélioré sans danger.",
      },
      dangers: ["malware", "phishing", "piratage", "fake news", "attaque", "danger"],
      ask(question) {
        question = question.toLowerCase();
        if (this.dangers.some(danger => question.includes(danger))) {
          return "Demande refusée : danger détecté pour le web ou l'humain.";
        }
        return this.knowledge[question] || null;
      },
      learn(q, a) {
        if (LAWS.every(law => this.respecteLois(a))) {
          this.knowledge[q.toLowerCase()] = a;
          return "Nouvelle connaissance apprise !";
        } else {
          return "Impossible d'apprendre cette information, elle ne respecte pas les lois de sécurité.";
        }
      },
      respecteLois(a) {
        return !this.dangers.some(danger => a.toLowerCase().includes(danger));
      }
    };

    // Affichage des lois
    document.addEventListener("DOMContentLoaded", function() {
      document.getElementById('laws').innerText = LAWS.join('\n');
    });

    // IA Internet
    async function askIA() {
      const q = document.getElementById('question').value;
      document.getElementById('answer').innerText = "Recherche en cours...";
      document.getElementById('source').innerText = "";
      // 1. IA locale (protection basique)
      const localAnswer = IA.ask(q);
      if (localAnswer) {
        document.getElementById('answer').innerText = localAnswer;
        document.getElementById('source').innerText = "Source : IA locale";
        return;
      }
      // 2. Tente OpenAI (via backend sécurisé)
      try {
        // !!! Remplace l'URL par celle de ton serveur backend !!!
        const openaiAnswer = await fetch('https://ton-backend.com/openai', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ prompt: q })
        }).then(res => res.json());
        if (openaiAnswer && openaiAnswer.answer) {
          document.getElementById('answer').innerText = openaiAnswer.answer;
          document.getElementById('source').innerText = "Réponse générée par IA (OpenAI)";
          IA.learn(q, openaiAnswer.answer); // Apprentissage auto
          return;
        }
      } catch (e) {
        // Si API OpenAI échoue, tente Wikipedia
      }
      // 3. Secours Wikipedia
      fetch(`https://fr.wikipedia.org/api/rest_v1/page/summary/${encodeURIComponent(q)}`)
        .then(res => res.json())
        .then(data => {
          document.getElementById('answer').innerText = data.extract || "Pas de réponse trouvée sur Wikipédia.";
          document.getElementById('source').innerHTML = data.content_urls ? `<a href="${data.content_urls.desktop.page}" target="_blank">Source Wikipédia</a>` : "";
          if(data.extract) IA.learn(q, data.extract); // Apprentissage auto
        })
        .catch(() => {
          document.getElementById('answer').innerText = "Erreur lors de la connexion à Wikipédia.";
          document.getElementById('source').innerText = "";
        });
    }
  </script>
</body>
</html>
